<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Website</title>
  <link rel="stylesheet" href="../css/product_page.css">
</head>
<body>
  <!-- Header Section -->
  <header class="header">
    <!-- Slider Section -->
    <div class="slider">
      <% if (slides && slides.length > 0) { %>
        <div class="slide" style="background-image: url('./images/uploded_image/<%= slides[0].name %>');">

          <nav class="navbar">
            <div class="logo">Logo</div>

            <div id="overlay"></div>

            <div class="search-container">
              <input type="text" id="searchBar" placeholder="Search products..." />
              <div id="suggestions"></div>
            </div>
            
            <div id="results"></div>
              <!-- <div id="results"></div> -->
            <!-- </div> -->
            
            <ul class="nav-links  " >
                  <% if (userRole === 'admin') { %>
  <li><a href="/admin/chat">Admin Chat</a></li>
<% } %>
<% if (userRole === 'user') { %>
<li><a href="/user/chat">Chat Support</a></li>
<% } %>
              <li><a href="/openrouter-chat">Chat Ai</a></li>
             
              <li><a href="/home">Home</a></li>
              <li><a href="/about">About Us</a></li>
              <li><a href="/product?category=indoor">Products</a></li>
              <li><a href="sign_in" onclick="openLoginWindow()">Sign in</a></li>
            </ul>
            <div class="menu-icon background-icons" onclick="toggleMenu()">☰</div>

            <!-- Menu -->
            <div class="menu background-icons" id="menu">
              <ul>
                    <% if (userRole === 'admin') { %>
  <li><a href="/admin/chat">Admin Chat</a></li>
<% } %>
<% if (userRole === 'user') { %>
<li><a href="/user/chat">Chat Support</a></li>
<% } %>
              <li><a href="/openrouter-chat">Chat Ai</a></li>
             
                <li><a href="/home">Home</a></li>
                <li><a href="/about">About</a></li>
                <li><a href="/product?category=indoor">Product</a></li>
                <li><a href="/sign_in">Sign In</a></li>
              </ul>
            </div>
            
          </nav>

          <h4 class="slider-title">
            <span class="welcome-text">Welcome to My Workshop</span><br>
            Jai Jeen Mata Welding Workshop<br>
            Contact No. 8930081481
          </h4> 

          <a href=https://maps.app.goo.gl/U28yWXRhCx8EbUCf8 class="btn" target="_blank"><img src="./images/logo/location.svg" alt=""></a>
        </div>
      <% } %>
      <button class="prev" onclick="prevSlide()">&#10094;</button>
      <button class="next" onclick="nextSlide()">&#10095;</button>
    </div>
  </header>


  
 <!-- Product Range Section -->
  <section class="product-range">
    <h2>Product Range</h2>
    <div class="products">
      <a href="/product?category=indoor" class="product">
        <img src='./images/product_range_image/indoor.jfif' alt="Indoor Items">
        <span>Indoor Items</span>
      </a>
      <a href="/product?category=outdoor" class="product">
        <img src='./images/product_range_image/outdoor.jfif' alt="Outdoor Items">
        <span>Outdoor Items</span>
      </a>
      <a href="/product?category=counter" class="product">
        <img src='./images/product_range_image/counter.jfif' alt="Counter">
        <span>Counter</span>
      </a>
      <a href="/product?category=art" class="product">
        <img src='./images/product_range_image/art.jfif' alt="3D Art">
        <span>3D Art</span>
      </a>
      <a href="/product?category=other" class="product">
        <img src='./images/product_range_image/other.jfif' alt="Other">
        <span>Other</span>
      </a>
    </div>
  
    <% if (userRole == 'admin') { %>
    <!-- Admin Upload Form -->
    <form action="/product" method="post" enctype="multipart/form-data" class="admin_image">
      <input type="file" name="images" multiple required>
      <input type="number" name="number" placeholder="1,2,3,4,5" min="1" max="5" required>
      <button type="submit" class="image_up">Upload</button>
    </form>
  
    <!-- Delete Section -->
    <form action="/product_delete_image" method="post" class="delete-section">
      <input type="text" id="categories" name="categories" readonly placeholder="category">

      <input type="text" id="currentImage_name" name="imageName" readonly placeholder="currentImage_name">
      <button type="submit" class="image_up">Delete</button>
    </form>
    <% } %>
  </section>
  
  <!-- carousel-section product images according to catageries -->
  <section class="carousel-section">
    <div class="carousel">
      <div class="carousel-track" id="carousel-track">
        <!-- Images will be dynamically inserted here -->
      </div>
    </div>
  </section>
  
 <!-- galiry images -->
 <% if (userRole=='admin' ) { %>
  <!-- Admin Upload Form -->
  <form action="/product" method="post" enctype="multipart/form-data" class="admin_image">
    <input type="file" name="images" multiple required>
    <input type="hidden" name="single_img" value="single_img">
    <input type="number" name="G_number" placeholder="1,2,3,4,5" min="1" max="5" required>
    <button type="submit" class="image_up">Upload</button>
  </form>

  <!-- Delete Section -->
  <form action="/product_delete_image" method="post" class="delete-section">
    <input type="text" id="categories" name="categories" readonly placeholder="category">
    <input type="hidden" name="product_single_img" value="product_single_img">
    <input type="text" id="currentImage_name" name="imageName" readonly placeholder="currentImage_name">
    <button type="submit" class="image_up">Delete</button>
  </form>
  <% } %>

  <h2>Like other <%=category%>
  </h2>
  <div class="image-gallery">
    <div class="image-category">
      <div class="image-list" id="<%=category%>-images"></div>
    </div>
  </div>




  <script>

function toggleMenu() {
  const menu = document.getElementById("menu");
  menu.classList.toggle("show");  // Show or hide the menu when the icon is clicked
}

// Hide the menu when mouse moves outside
document.addEventListener('click', function(event) {
  const menu = document.getElementById("menu");
  const menuIcon = document.querySelector(".menu-icon");
  
  // Close the menu if the click is outside the menu or icon
  if (!menu.contains(event.target) && event.target !== menuIcon) {
    menu.classList.remove("show");
  }
});



    let currentSlide = 0;
    const slides = <%- JSON.stringify(slides) %>; // Server-side data

    if (slides && slides.length > 0) {
      const slideElement = document.querySelector(".slide");
      slideElement.style.backgroundImage = `url('./images/uploded_image/${slides[currentSlide].name}')`;
    }

    function showSlide(index) {
      const slideElement = document.querySelector(".slide");
      if (slideElement && slides.length > 0) {
        slideElement.style.backgroundImage = `url('./images/uploded_image/${slides[index].name}')`;
        slideElement.classList.add("active");
      } else {
        console.error("Slide element not found or slides array is empty!");
      }
    }

    function nextSlide() {
      currentSlide = (currentSlide + 1) % slides.length; // Cycle to next
      showSlide(currentSlide);
    }

    function prevSlide() {
      currentSlide = (currentSlide - 1 + slides.length) % slides.length; // Cycle back
      showSlide(currentSlide);
    }

    // Automatically initialize first slide
    if (slides && slides.length > 0) {
      showSlide(currentSlide);
    }

    // Add event listeners for hover
    const sliderElement = document.querySelector(".slider");

    if (sliderElement) {
      let slideshowInterval = setInterval(nextSlide, 8000); // Automatically change slides every 8 seconds

      // Pause slideshow on hover
      sliderElement.addEventListener("mouseenter", () => {
        clearInterval(slideshowInterval); // Stop auto-slide
      });

      // Resume slideshow on hover out
      sliderElement.addEventListener("mouseleave", () => {
        slideshowInterval = setInterval(nextSlide, 8000); // Restart auto-slide
      });
    }


    //  ...........carousel-section
    const product = <%- JSON.stringify(product) %>;
function updateCarousel(category) {
  const carouselSection = document.querySelector('.carousel-section');
  carouselSection.innerHTML = ''; // Clear existing carousels

  if (product[0] && Array.isArray(product[0][category]) && product[0][category].length > 0) {
    const images = product[0][category];
    let rows = Math.ceil(images.length / 25); // Number of rows required

    for (let i = 0; i < rows; i++) {
      const carouselRow = document.createElement('div');
      carouselRow.className = 'carousel-row';

      const start = i * 25;
      const end = start + 25;
      const rowImages = images.slice(start, end);

      rowImages.forEach((image) => {
        // Main carousel item
        const carouselItem = document.createElement('a');
        carouselItem.className = 'carousel-item image_size';
        carouselItem.style.backgroundImage = `url('./images/uploded_image/${image}')`;
        carouselItem.href = `/product_details?image=${image}`;
        carouselItem.style.position = 'relative';

        // Hover data update
        carouselItem.addEventListener('mouseover', () => {
          const categories = document.getElementById('categories');
          const currentImage_name = document.getElementById('currentImage_name');
          categories.value = `${category}`;
          currentImage_name.value = `${image}`;
        });

        // Create edit icon with popup behavior
        const editIcon = document.createElement('span');
        editIcon.className = 'edit-icon';
        editIcon.innerHTML = '✏️'; // Optional: Replace with SVG or font icon
        editIcon.style.position = 'absolute';
        editIcon.style.top = '5px';
        editIcon.style.right = '5px';
        editIcon.style.background = 'rgba(255, 255, 255, 0.8)';
        editIcon.style.padding = '2px 6px';
        editIcon.style.borderRadius = '4px';
        editIcon.style.textDecoration = 'none';
        editIcon.style.color = '#000';
        editIcon.style.fontSize = '14px';
        editIcon.style.cursor = 'pointer';
        editIcon.title = 'Edit Details';

        // Open small window for editing
        editIcon.addEventListener('click', (e) => {
          e.stopPropagation();
          e.preventDefault();
          window.open(
            `http://localhost:8000/products/full-entry?imageName=${image}`,
            '_blank',
            'width=600,height=500,top=100,left=100,resizable=yes,scrollbars=yes'
          );
        });

        carouselItem.appendChild(editIcon); // Add icon inside the image block
        carouselRow.appendChild(carouselItem); // Add to the row
      });

      carouselSection.appendChild(carouselRow); // Add row to section
    }
  } else {
    console.error(`No images found for category: ${category}`);
    carouselSection.innerHTML = `<p>No images available for "${category}".</p>`;
  }
}

// Default category on load
let category = <%- JSON.stringify(category) %>;

updateCarousel(category);

 
 

// Hide the menu when mouse moves outside
document.addEventListener('click', function(event) {
  const menu = document.getElementById("menu");
  const menuIcon = document.querySelector(".menu-icon");
  
  // Close the menu if the click is outside the menu or icon
  if (!menu.contains(event.target) && event.target !== menuIcon) {
    menu.classList.remove("show");
  }
});

//  
   // single image
const single = <%- JSON.stringify(single_product_img) %>; // Server-side data

function loadImages(category, imagesData) {
    console.log("Selected Category:", category); 
    console.log("Images Data:", imagesData);

    const container = document.getElementById(`${category}-images`);
    if (container && imagesData[0][category]) { // Access images using category name
        imagesData[0][category].forEach(img => {
            const imgElement = document.createElement("img");
            imgElement.src = `./images/uploded_image/${img}`; // Adjust path as needed
            imgElement.alt = `${category} image`;
            container.appendChild(imgElement);
        });
    }
}

// Load images based on category
loadImages(category, single);


  </script>
  <script src="/js/search.js"></script>

</body>
</html>
